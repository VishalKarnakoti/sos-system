<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SafeGuard â€“ Multi User SOS</title>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
margin:0;
font-family:'DM Sans',sans-serif;
background:#f1faee;
}
.hero{
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#1D3557,#0A0E27);
color:white;
text-align:center;
padding:2rem;
}
h1{
font-family:'Bebas Neue';
font-size:4rem;
margin-bottom:1rem;
}
h1 span{color:#E63946}
button{
padding:1rem 2rem;
border:none;
background:#E63946;
color:white;
font-weight:bold;
border-radius:30px;
cursor:pointer;
}
.sos{
margin-top:2rem;
width:250px;
height:250px;
border-radius:50%;
background:#E63946;
display:flex;
align-items:center;
justify-content:center;
font-family:'Bebas Neue';
font-size:5rem;
margin:auto;
animation:pulse 2s infinite;
cursor:pointer;
}
@keyframes pulse{
0%{box-shadow:0 0 0 0 rgba(230,57,70,.7)}
70%{box-shadow:0 0 0 40px rgba(230,57,70,0)}
100%{box-shadow:0 0 0 0 rgba(230,57,70,0)}
}
#modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,.9);
z-index:9999;
overflow:auto;
}
.modal-box{
background:white;
max-width:1000px;
margin:2rem auto;
padding:2rem;
border-radius:15px;
}
.close{
float:right;
font-size:2rem;
cursor:pointer;
}
#map{
height:400px;
margin-top:1rem;
border-radius:10px;
}
</style>
</head>

<body>

<section class="hero">
<div>
<h1>SAFEGUARD<br><span>WOMEN SAFETY</span></h1>
<p>Multi-User SOS Alert Simulation</p>
<button onclick="activateSOS()">ðŸš¨ ACTIVATE SOS</button>
<div class="sos" onclick="activateSOS()">SOS</div>
</div>
</section>

<div id="modal">
<div class="modal-box">
<span class="close" onclick="closeSOS()">Ã—</span>

<h2 style="color:#E63946;text-align:center">ðŸš¨ SOS ACTIVATED</h2>
<p style="text-align:center">Live SOS users are shown on the map</p>

<div id="info">Detecting location...</div>
<div id="coords"></div>

<div id="map"></div>

<div style="text-align:center;margin-top:1rem">
<button onclick="closeSOS()">ðŸ›‘ CANCEL ALERT</button>
</div>
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ---------- MULTI USER STORAGE ---------- */
const SOS_KEY = "ACTIVE_SOS_USERS";
const USER_ID = "user_" + Math.floor(Math.random()*100000);

let map, marker, watchId;

/* ---------- ACTIVATE SOS ---------- */
function activateSOS(){
document.getElementById("modal").style.display="block";
document.body.style.overflow="hidden";

if(!navigator.geolocation){
document.getElementById("info").innerText="Geolocation not supported";
return;
}

navigator.geolocation.getCurrentPosition(success,error,{enableHighAccuracy:true});
}

/* ---------- SUCCESS ---------- */
function success(pos){
const lat = pos.coords.latitude;
const lng = pos.coords.longitude;
const acc = pos.coords.accuracy;

document.getElementById("coords").innerHTML =
`Lat: ${lat.toFixed(6)} | Lng: ${lng.toFixed(6)} | Accuracy: Â±${Math.round(acc)}m`;

saveSOS(lat,lng);
loadMap(lat,lng);
renderAllSOS();

/* Live tracking */
watchId = navigator.geolocation.watchPosition(p=>{
saveSOS(p.coords.latitude,p.coords.longitude);
marker.setLatLng([p.coords.latitude,p.coords.longitude]);
});
}

/* ---------- ERROR / DEMO ---------- */
function error(err){
document.getElementById("info").innerHTML =
"<b>Demo Mode</b><br>"+err.message;

loadMap(28.6139,77.2090);
saveSOS(28.6139,77.2090);
renderAllSOS();
}

/* ---------- MAP ---------- */
function loadMap(lat,lng){
map = L.map("map").setView([lat,lng],16);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);

marker = L.marker([lat,lng]).addTo(map)
.bindPopup("ðŸš¨ You (SOS)").openPopup();

L.circle([lat,lng],{
radius:500,
color:"#E63946",
fillOpacity:0.2
}).addTo(map);
}

/* ---------- MULTI USER LOGIC ---------- */
function saveSOS(lat,lng){
const data = JSON.parse(localStorage.getItem(SOS_KEY)) || {};
data[USER_ID] = {lat,lng,time:new Date().toLocaleTimeString()};
localStorage.setItem(SOS_KEY,JSON.stringify(data));
}

function getAllSOS(){
return JSON.parse(localStorage.getItem(SOS_KEY)) || {};
}

function renderAllSOS(){
if(!map) return;

const users = getAllSOS();

Object.keys(users).forEach(id=>{
if(id === USER_ID) return;

const u = users[id];

const icon = L.divIcon({
html:`<div style="
background:black;
color:white;
width:30px;
height:30px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:12px;">SOS</div>`,
iconSize:[30,30]
});

L.marker([u.lat,u.lng],{icon})
.addTo(map)
.bindPopup(`ðŸš¨ Another User<br>Time: ${u.time}`);
});
}

/* ---------- AUTO UPDATE ---------- */
setInterval(renderAllSOS,3000);

/* ---------- CLOSE ---------- */
function closeSOS(){
const data = getAllSOS();
delete data[USER_ID];
localStorage.setItem(SOS_KEY,JSON.stringify(data));

document.getElementById("modal").style.display="none";
document.body.style.overflow="auto";

if(watchId) navigator.geolocation.clearWatch(watchId);
if(map){ map.remove(); map=null; }
}
</script>

</body>
</html>
